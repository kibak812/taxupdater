<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_name }} - ì˜ˆê·œíŒë¡€ í¬ë¡¤ë§ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><text y='20' font-size='20'>ğŸ“„</text></svg>">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <h1>ğŸ“„ {{ site_name }} ë°ì´í„°</h1>
            <p>ì˜ˆê·œíŒë¡€ í¬ë¡¤ë§ ì‹œìŠ¤í…œ - ì‚¬ì´íŠ¸ë³„ ìƒì„¸ ë°ì´í„° ì¡°íšŒ</p>
        </div>
    </header>

    <div class="container">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="global-actions" style="margin-bottom: 1rem;">
            <div class="global-buttons">
                <a href="/" class="btn btn-secondary">
                    ğŸ  ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </a>
                <button class="btn btn-primary" onclick="startCrawling('{{ site_key }}')">
                    ğŸ”„ {{ site_name }} í¬ë¡¤ë§
                </button>
                <button class="btn btn-secondary" onclick="location.reload()">
                    ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>

        <!-- í¬ë¡¤ë§ ìƒíƒœ í‘œì‹œ -->
        <div id="crawlStatusContainer" style="display: none;" class="global-actions">
            <h3>âš¡ {{ site_name }} í¬ë¡¤ë§ ì§„í–‰ ìƒí™©</h3>
            <div id="crawlStatus" style="font-size: 1.1rem; color: #3B82F6; font-weight: 500;">
                ëŒ€ê¸° ì¤‘...
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="crawlProgress"></div>
            </div>
        </div>

        <!-- ì‚¬ì´íŠ¸ ë°ì´í„° í…Œì´ë¸” -->
        <div id="siteData">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            <div class="data-table">
                <div class="table-header">
                    <h3>{{ site_name }} ë°ì´í„° ë¡œë”© ì¤‘...</h3>
                    <div class="table-controls">
                        <input type="text" class="search-input" placeholder="ê²€ìƒ‰..." disabled>
                        <button class="btn btn-secondary btn-sm" disabled>
                            ğŸ“¤ Excel ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>
                
                <div style="padding: 2rem; text-align: center; color: #64748b;">
                    <div class="loading" style="display: inline-block; margin-right: 0.5rem;"></div>
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
        <div class="global-actions" style="margin-top: 2rem;">
            <h3>ğŸ”§ ë¹ ë¥¸ ì•¡ì…˜</h3>
            <div class="global-buttons">
                <button class="btn btn-success" onclick="startCrawling('{{ site_key }}')">
                    ğŸ†• ìƒˆ ë°ì´í„° ìˆ˜ì§‘
                </button>
                <button class="btn btn-secondary" onclick="filterNewData()">
                    âœ¨ ìµœê·¼ ë°ì´í„°ë§Œ ë³´ê¸°
                </button>
                <button class="btn btn-secondary" onclick="clearSearch()">
                    ğŸ§¹ ê²€ìƒ‰ ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- ì‚¬ì´íŠ¸ ì •ë³´ -->
        <div class="global-actions" style="margin-top: 2rem;">
            <h3>ğŸ“‹ {{ site_name }} ì •ë³´</h3>
            <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                <div class="stat-item" style="margin-bottom: 0.5rem;">
                    <span class="stat-label">ì‚¬ì´íŠ¸ í‚¤</span>
                    <span class="stat-value">{{ site_key }}</span>
                </div>
                <div class="stat-item" style="margin-bottom: 0.5rem;">
                    <span class="stat-label">ë°ì´í„° íƒ€ì…</span>
                    <span class="stat-value" id="dataTypeInfo">ë¡œë”© ì¤‘...</span>
                </div>
                <div class="stat-item" style="margin-bottom: 0.5rem;">
                    <span class="stat-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</span>
                    <span class="stat-value" id="lastUpdateInfo">ë¡œë”© ì¤‘...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì´ ë ˆì½”ë“œ ìˆ˜</span>
                    <span class="stat-value" id="totalRecordsInfo">ë¡œë”© ì¤‘...</span>
                </div>
            </div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
        <div id="connectionStatus" style="text-align: center; margin-top: 2rem; color: #64748b; font-size: 0.875rem;">
            ğŸ”Œ ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ: <span id="connectionIndicator">ì—°ê²° ì¤‘...</span>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/main.js"></script>
    
    <script>
        // ì‚¬ì´íŠ¸ë³„ í˜ì´ì§€ íŠ¹í™” ê¸°ëŠ¥
        
        function filterNewData() {
            // ìµœê·¼ 24ì‹œê°„ ì´ë‚´ ë°ì´í„° í•„í„°ë§ (í–¥í›„ êµ¬í˜„)
            app.showNotification('ìµœê·¼ ë°ì´í„° í•„í„°ë§ ê¸°ëŠ¥ì€ í–¥í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.', 'info');
        }

        function clearSearch() {
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.value = '';
                // URLì—ì„œ search íŒŒë¼ë¯¸í„° ì œê±°
                const url = new URL(window.location);
                url.searchParams.delete('search');
                url.searchParams.set('page', '1');
                window.location.href = url.toString();
            }
        }

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connectionIndicator');
            if (connected) {
                indicator.textContent = 'ì—°ê²°ë¨ âœ…';
                indicator.style.color = '#10B981';
            } else {
                indicator.textContent = 'ì—°ê²° ëŠì–´ì§ âŒ';
                indicator.style.color = '#EF4444';
            }
        }

        // í¬ë¡¤ë§ ìƒíƒœ í‘œì‹œ/ìˆ¨ê¹€
        function toggleCrawlStatus(show) {
            const container = document.getElementById('crawlStatusContainer');
            if (container) {
                container.style.display = show ? 'block' : 'none';
            }
        }

        // ì‚¬ì´íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSiteInfo(data) {
            const dataTypeMap = {
                'tax_tribunal': 'ì¡°ì„¸ì‹¬íŒì› ê²°ì •ì„œ',
                'nts_authority': 'êµ­ì„¸ì²­ ìœ ê¶Œí•´ì„',
                'moef': 'ê¸°íšì¬ì •ë¶€ í•´ì„ì‚¬ë¡€',
                'nts_precedent': 'êµ­ì„¸ì²­ íŒë¡€',
                'mois': 'í–‰ì •ì•ˆì „ë¶€ í•´ì„ì‚¬ë¡€',
                'bai': 'ê°ì‚¬ì› ì‹¬ì‚¬ì‚¬ë¡€'
            };

            document.getElementById('dataTypeInfo').textContent = 
                dataTypeMap['{{ site_key }}'] || '{{ site_name }} ë°ì´í„°';
            
            if (data && data.pagination) {
                document.getElementById('totalRecordsInfo').textContent = 
                    data.pagination.total_count.toLocaleString() + 'ê°œ';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ì´íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            // WebSocket ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
            setTimeout(() => {
                if (window.app && window.app.isConnected) {
                    updateConnectionStatus(true);
                } else {
                    updateConnectionStatus(false);
                }
            }, 2000);

            // ì£¼ê¸°ì ìœ¼ë¡œ ì—°ê²° ìƒíƒœ í™•ì¸
            setInterval(() => {
                if (window.app) {
                    updateConnectionStatus(window.app.isConnected);
                }
            }, 5000);

            // ì‚¬ì´íŠ¸ ë°ì´í„° ë¡œë“œ í›„ ì •ë³´ ì—…ë°ì´íŠ¸
            const originalRenderSiteData = window.app?.renderSiteData;
            if (originalRenderSiteData) {
                window.app.renderSiteData = function(data) {
                    originalRenderSiteData.call(this, data);
                    updateSiteInfo(data);
                };
            }
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + R: ìƒˆë¡œê³ ì¹¨
            if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                event.preventDefault();
                location.reload();
            }
            
            // Ctrl/Cmd + F: ê²€ìƒ‰ í¬ì»¤ìŠ¤
            if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
                event.preventDefault();
                const searchInput = document.querySelector('.search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
    </script>
</body>
</html>